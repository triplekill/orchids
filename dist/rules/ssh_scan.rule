
rule ssh_scan {
  state init {
    $ip = .sshd.src_ip;
    $counter = 0;

    expect (.sshd.action == "Illegal user")
      goto bad_user;
  }

  sate bad_user {
   $counter = $counter + 1;

   expect (.sshd.action == "Illegal user" && .sshd.src_ip == $ip)
     goto bad_user;

   expect ($counter == 10)
     goto alert;
  }

  
}
