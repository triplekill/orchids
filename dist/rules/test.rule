/*
** demu Rule
*/

rule demoRule
{
  state init
  {

    // Test 1 Const print
    print(1);
    print("OK");

    // Test 2 Var assignement
    $var1 = 1;
    $var2 = "OK";
    print($var1);
    print($var2);


    // Test 3 if then else
    if ($var1)
      print("OK");
    else
      print("KO");

    // Test 4 if then else multiple actions
    if ($var1)
    {
      $msg = "OK";
      print($msg);
    }
    else
    {
      $msg = "KO";
      print($msg);
    }

    // Test 5 Logic expression assignement
    $var1 = 1;
    $var2 = (($var1 == 0) || ($var1 == 1));
    if ($var2)
      print("OK");
    else
      print("KO");

    // Test 6 Regex Split
    $string = "Hello World !";
    / $string / "([^ ]+) ([^ ]+)" / $hello / $world;
    print($string);
    print($hello);
    print($world);

    // Test 7 Regex Match
    $string = "Hello World !";
    if ($string =~ _REGEX ("Hello"))
      print("OK");
    else
      print("KO");

    // Test 8 Regex Not Match
    $string = "Hello World !";
    if ($string !~ _REGEX ("Hllo"))
      print("OK");
    else
      print("KO");



    expect (defined (.udp.msg) == 1)
      goto udp;

    expect (defined (.textfile.line) == 1)
      goto txt;
  }

  state udp
  {
    print("UDP packet received");
  }

  state txt
  {
    print("TXT line read");
  }
}
